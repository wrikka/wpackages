<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Env Manager</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
			background: #1a1a2e;
			color: #eee;
			min-height: 100vh;
			padding: 20px;
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
		}

		.header {
			margin-bottom: 30px;
		}

		.header h1 {
			font-size: 2rem;
			margin-bottom: 10px;
		}

		.header p {
			color: #888;
		}

		.card {
			background: #16213e;
			border-radius: 8px;
			padding: 20px;
			margin-bottom: 20px;
		}

		.card h2 {
			font-size: 1.25rem;
			margin-bottom: 15px;
			color: #4ecca3;
		}

		.env-list {
			display: grid;
			gap: 10px;
		}

		.env-item {
			display: flex;
			align-items: center;
			gap: 10px;
			padding: 10px;
			background: #0f3460;
			border-radius: 4px;
		}

		.env-key {
			font-weight: bold;
			min-width: 150px;
			color: #4ecca3;
		}

		.env-value {
			flex: 1;
			font-family: monospace;
			word-break: break-all;
		}

		.env-sensitive {
			color: #e94560;
		}

		.actions {
			display: flex;
			gap: 10px;
			margin-top: 20px;
		}

		.btn {
			padding: 10px 20px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			font-weight: bold;
			transition: background 0.2s;
		}

		.btn-primary {
			background: #4ecca3;
			color: #0f3460;
		}

		.btn-primary:hover {
			background: #3db892;
		}

		.btn-secondary {
			background: #0f3460;
			color: #eee;
		}

		.btn-secondary:hover {
			background: #1a4b8c;
		}

		.btn-danger {
			background: #e94560;
			color: #eee;
		}

		.btn-danger:hover {
			background: #d63d56;
		}

		.status {
			display: inline-block;
			padding: 4px 8px;
			border-radius: 4px;
			font-size: 0.875rem;
			font-weight: bold;
		}

		.status-success {
			background: #4ecca3;
			color: #0f3460;
		}

		.status-warning {
			background: #f39c12;
			color: #0f3460;
		}

		.status-error {
			background: #e94560;
			color: #eee;
		}

		.modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.7);
			justify-content: center;
			align-items: center;
			z-index: 1000;
		}

		.modal.active {
			display: flex;
		}

		.modal-content {
			background: #16213e;
			border-radius: 8px;
			padding: 20px;
			max-width: 500px;
			width: 90%;
		}

		.modal h3 {
			margin-bottom: 15px;
		}

		.form-group {
			margin-bottom: 15px;
		}

		.form-group label {
			display: block;
			margin-bottom: 5px;
			font-weight: bold;
		}

		.form-group input,
		.form-group textarea {
			width: 100%;
			padding: 10px;
			border: 1px solid #0f3460;
			border-radius: 4px;
			background: #0f3460;
			color: #eee;
		}

		.form-group input:focus,
		.form-group textarea:focus {
			outline: none;
			border-color: #4ecca3;
		}

		.modal-actions {
			display: flex;
			gap: 10px;
			justify-content: flex-end;
			margin-top: 20px;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="header">
			<h1>ðŸ”§ Environment Manager</h1>
			<p>Manage your environment variables with ease</p>
		</div>

		<div class="card">
			<h2>Environment Variables</h2>
			<div id="envList" class="env-list"></div>
			<div class="actions">
				<button class="btn btn-primary" onclick="openAddModal()">+ Add Variable</button>
				<button class="btn btn-secondary" onclick="generateExample()">Generate Example</button>
				<button class="btn btn-secondary" onclick="runAudit()">Run Audit</button>
			</div>
		</div>

		<div class="card">
			<h2>Status</h2>
			<div id="status"></div>
		</div>
	</div>

	<div id="addModal" class="modal">
		<div class="modal-content">
			<h3>Add Environment Variable</h3>
			<div class="form-group">
				<label for="key">Key</label>
				<input type="text" id="key" placeholder="MY_VARIABLE">
			</div>
			<div class="form-group">
				<label for="value">Value</label>
				<input type="text" id="value" placeholder="my-value">
			</div>
			<div class="modal-actions">
				<button class="btn btn-secondary" onclick="closeAddModal()">Cancel</button>
				<button class="btn btn-primary" onclick="addVariable()">Add</button>
			</div>
		</div>
	</div>

	<script>
		let envVars = {};

		function loadEnv() {
			fetch('/api/env')
				.then((res) => res.json())
				.then((data) => {
					envVars = data;
					renderEnvList();
					updateStatus();
				});
		}

		function renderEnvList() {
			const container = document.getElementById('envList');
			container.innerHTML = '';

			for (const [key, value] of Object.entries(envVars)) {
				const isSensitive = isSensitiveKey(key);
				const item = document.createElement('div');
				item.className = 'env-item';
				item.innerHTML = `
					<div class="env-key">${key}</div>
					<div class="env-value ${isSensitive ? 'env-sensitive' : ''}">${isSensitive ? '***' : value}</div>
					<button class="btn btn-danger" onclick="deleteVariable('${key}')">Delete</button>
				`;
				container.appendChild(item);
			}
		}

		function isSensitiveKey(key) {
			const sensitivePatterns = ['password', 'secret', 'token', 'key', 'api', 'auth', 'credential', 'private'];
			return sensitivePatterns.some((pattern) => key.toLowerCase().includes(pattern));
		}

		function updateStatus() {
			const status = document.getElementById('status');
			const count = Object.keys(envVars).length;
			const sensitiveCount = Object.keys(envVars).filter((k) => isSensitiveKey(k)).length;

			status.innerHTML = `
				<span class="status status-success">Total: ${count}</span>
				<span class="status status-warning">Sensitive: ${sensitiveCount}</span>
			`;
		}

		function openAddModal() {
			document.getElementById('addModal').classList.add('active');
		}

		function closeAddModal() {
			document.getElementById('addModal').classList.remove('active');
			document.getElementById('key').value = '';
			document.getElementById('value').value = '';
		}

		function addVariable() {
			const key = document.getElementById('key').value;
			const value = document.getElementById('value').value;

			if (!key || !value) {
				alert('Please fill in all fields');
				return;
			}

			fetch('/api/env', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ key, value }),
			}).then(() => {
				closeAddModal();
				loadEnv();
			});
		}

		function deleteVariable(key) {
			if (!confirm(`Delete ${key}?`)) return;

			fetch(`/api/env/${key}`, { method: 'DELETE' }).then(() => {
				loadEnv();
			});
		}

		function generateExample() {
			fetch('/api/example', { method: 'POST' }).then(() => {
				alert('.env.example generated!');
			});
		}

		function runAudit() {
			fetch('/api/audit')
				.then((res) => res.json())
				.then((data) => {
					alert(JSON.stringify(data, null, 2));
				});
		}

		loadEnv();
		setInterval(loadEnv, 5000);
	</script>
</body>
</html>
